---
import { Post, User, asc, db, eq } from "astro:db"
import { marked } from "marked"
import Layout from "../layouts/Base.astro"

import Search from "@/components/Search.jsx"
import TG from "@/components/TG.astro"
import ZOOM from "@/components/ZOOM.astro"

// –≤–æ–≤–æ–¥ —Å –∏–º–µ–Ω–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–∏ÃÜ –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–∏–ª–∏ –ø–æ—Å—Ç
const postsList = await db
	.select()
	.from(Post)
	.innerJoin(User, eq(Post.userId, User.id))
	.orderBy(asc(Post.id))

// const postsListAA = await db
// 	.select()
// 	.from(Post)
// 	.innerJoin(User, eq(Post.userId, User.id))
// 	.where(like(Post.title, "%–ê–ê%"))
// 	.orderBy(asc(Post.id))

Astro.response.headers.set("CDN-Cache-Control", "public, max-age=172800, must-revalidate")
---

<Layout title="12 —à–∞–≥–æ–≤: –≥—Ä—É–ø–ø—ã, –º–∞—Ç–µ—Ä–∏–∞–ª—ã –∏ –ø—Ä–æ–µ–∫—Ç—ã." description="">
	<div class="pt-12 flex flex-col gap-6 pb-28 text-center w-full mx-auto md:max-w-2xl">
		<h1 class="tracking-tighter text-4xl md:text-6xl font-black">
			–ò—â–∏—Ç–µ –≥—Ä—É–ø–ø—ã –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å—É –∏ –ø–æ –≤–∞—à–∏–º –∑–∞–¥–∞—á–∞–º üëã
		</h1>
		<p class="text-zinc-600">
			12-—Ç–∏ —à–∞–≥–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã, –ø—Ä–æ–µ–∫—Ç—ã –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Ä–∞–∑–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π <i
				><b>(—Å–æ–æ–±—â–µ—Å—Ç–≤)</b></i
			> –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π.
		</p>
		<a
			href="https://t.me/all_groups12/5"
			tabindex="_blank"
			class="bg-red-50 hover:bg-red-100 transition-colors duration-75 ease-linear rounded-lg px-3 py-1 ring-1 ring-red-200 text-red-500"
		>
			–ù–∞—à–ª–∏ —Å–≤–æ—é –≥—Ä—É–ø–ø—É, –Ω–æ –µ–µ –¥–æ–±–∞–≤–∏–ª–∏ –±–µ–∑ –≤–∞—à–µ–≥–æ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è? - –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–∞–º.
		</a>
		<aside class="flex justify-center gap-3">
			<a
				href="https://t.me/all_groups12"
				target="_blank"
				class="bg-blue-50 hover:bg-blue-100 transition-colors duration-75 ease-linear rounded-lg px-3 py-1 ring-1 ring-blue-200 text-blue-500"
				>–æ–± –ø—Ä–æ–µ–∫—Ç–µ</a
			>

			<a
				href="https://t.me/all_groups12/3"
				target="_blank"
				class="bg-blue-50 hover:bg-blue-100 transition-colors duration-75 ease-linear rounded-lg px-3 py-1 ring-1 ring-blue-200 text-blue-500"
				>–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</a
			>
		</aside>
	</div>

	<section class="mb-12">
		<Search searchList={postsList} client:visible />
	</section>

	<section class="grid md:grid-cols-2 items-start lg:grid-cols-3 gap-5 grid-cols-1">
		{
			postsList &&
				postsList
					.sort((a, b) => b.Post.id - a.Post.id)
					.map((post, index) => (
						<article
							id={`–ø–æ—Å—Ç: ${post.Post.id}`}
							class={
								index === 0
									? "relative ring-1 rounded-lg ring-amber-500"
									: index === 1
										? "relative ring-1 rounded-lg ring-blue-500"
										: "relative"
							}
						>
							<main
								class="bg-white border rounded-lg border-gray-200  
              p-5 flex flex-col gap-3"
							>
								<div class="flex justify-between items-center">
									<span class=" font-medium text-zinc-400 text-xs">
										üë§ {post?.User?.username}
									</span>
									<span
										class={index === 0 ? "text-sm text-amber-500 font-bold" : "hidden"}
									>
										–Ω–æ–≤–∞—è üéâ
									</span>
									{index === 1 ? (
										<span class="text-sm text-blue-500 font-bold">–≤—Ç–æ—Ä–∞—è üéÅ</span>
									) : (
										""
									)}
								</div>
								<h2 class="text-xl font-bold">{post.Post.title}</h2>
								<div class="prose text-sm" set:html={marked(post.Post.description)} />
								<a
									href={`https://${post?.Post?.link}`}
									id="link"
									target="_blank"
									class={`text-sm flex justify-center gap-3 items-center px-5 py-2.5 text-center rounded-md 
                  ${
										post?.Post?.link.startsWith("t.me")
											? "bg-sky-100 text-sky-700 ring-1 ring-sky-200 transition-colors duration-75 ease-linear hover:bg-sky-200"
											: post?.Post?.link.startsWith("zoom")
												? "bg-blue-100 text-blue-700 ring-1 ring-blue-200 transition-colors duration-75 ease-linear hover:bg-blue-200"
												: "bg-green-100 text-green-700 ring-1 ring-green-200 transition-colors duration-75 ease-linear hover:bg-green-200"
									}`}
								>
									{post?.Post?.link.startsWith("t.me") ? <TG /> : ""}
									{post?.Post?.link.startsWith("zoom") ? <ZOOM /> : ""}
									–ü–µ—Ä–µ–π—Ç–µ –ø–æ —Å—Å—ã–ª–∫–µ
								</a>
							</main>
						</article>
					))
		}

		<script>
			// –ù–∞–π—Ç–∏ –≤—Å–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∏ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–ª–∏–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π
			document.body.addEventListener("click", function (e) {
				// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ü–µ–ª—å –∫–ª–∏–∫–∞ —Å—Å—ã–ª–∫–æ–π
				if (e.target.tagName === "A") {
					// –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Å—Å—ã–ª–∫–∏
					e.preventDefault()

					// –û—Ç–ª–æ–∂–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
					setTimeout(() => {
						// –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
						const isHuman = confirm("–í—ã —á–µ–ª–æ–≤–µ–∫? –ù–∞–∂–º–∏—Ç–µ '–î–∞', —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.")

						// –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª, —á—Ç–æ –æ–Ω —á–µ–ª–æ–≤–µ–∫
						if (isHuman) {
							// –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –Ω—É–∂–Ω—É—é —Å—Å—ã–ª–∫—É
							window.open(e.target.href, "_blank")
						} else {
							// –ï—Å–ª–∏ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª, –≤—ã–¥–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
							alert("–î–æ—Å—Ç—É–ø –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, —á—Ç–æ –≤—ã —á–µ–ª–æ–≤–µ–∫, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å.")
						}
					}, 0) // –ò—Å–ø–æ–ª—å–∑—É–µ–º setTimeout –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
				}
			})

			// –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥—Ä—É–≥–∏—Ö —Ç—è–∂–µ–ª—ã—Ö –∑–∞–¥–∞—á, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
			window.addEventListener("load", () => {
				// –ù–∞–ø—Ä–∏–º–µ—Ä, –º–æ–∂–µ–º –∑–¥–µ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–∫—Ä–∏–ø—Ç—ã –∏–ª–∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ä–µ—Å—É—Ä—Å—ã –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ
				console.log("jopa!")
			})
		</script>
	</section>
</Layout>
