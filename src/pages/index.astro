---
import { Post, User, asc, db, eq } from "astro:db"
import { marked } from "marked"
import Layout from "../layouts/Base.astro"

import TG from "@/components/TG.astro"
import ZOOM from "@/components/ZOOM.astro"

// –≤–æ–≤–æ–¥ —Å –∏–º–µ–Ω–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–∏ÃÜ –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–±–∞–≤–∏–ª–∏ –ø–æ—Å—Ç
const postsList = await db
	.select()
	.from(Post)
	.innerJoin(User, eq(Post.userId, User.id))
	.orderBy(asc(Post.id))

// export const prerender = false
---

<Layout>
	<div class="pt-12 pb-28 text-center w-full mx-auto md:max-w-2xl">
		<h1 class="mb-6 tracking-tighter text-5xl md:text-6xl font-black">
			–ò—â–∏—Ç–µ –≥—Ä—É–ø–ø—ã –ø–æ –∏–Ω—Ç–µ—Ä–µ—Å—É –∏ –ø–æ –≤–∞—à–∏–º –∑–∞–¥–∞—á–∞–º üëã
		</h1>
		<p class="text-zinc-600">
			12-—Ç–∏ —à–∞–≥–æ–≤—ã–µ –≥—Ä—É–ø–ø—ã, –ø—Ä–æ–µ–∫—Ç—ã –∏ –º–∞—Ç–µ—Ä–∏–∞–ª—ã —Ä–∞–∑–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π <i
				><b>(—Å–æ–æ–±—â–µ—Å—Ç–≤)</b></i
			> –∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–π.
		</p>
	</div>

	<section class="grid md:grid-cols-2 items-start lg:grid-cols-3 gap-5 grid-cols-1">
		{
			postsList &&
				postsList
					.sort((a, b) => b.Post.id - a.Post.id)
					.map((post, index) => (
						<article
							id={`–ø–æ—Å—Ç: ${post.Post.id}`}
							class={index === 0 ? "relative ring-1 rounded-lg ring-amber-500" : ""}
						>
							<span
								class={
									index === 0
										? "absolute top-1 right-2 text-sm text-amber-500 font-bold"
										: "hidden"
								}
							>
								–Ω–æ–≤–∞—è üî•
							</span>
							{/* <span class="text-green-500">{post?.User?.username}</span> */}
							<main class="bg-white border rounded-lg border-gray-200  p-5 flex flex-col gap-3">
								<h2 class="text-xl font-bold">{post.Post.title}</h2>
								<div class="prose text-sm" set:html={marked(post.Post.description)} />
								<a
									href={`https://${post?.Post?.link}`}
									id="link"
									target="_blank"
									class={`text-sm flex justify-center gap-3 items-center px-5 py-2.5 text-center rounded-md 
    ${
			post?.Post?.link.startsWith("t.me")
				? "bg-sky-100 text-sky-700 ring-1 ring-sky-200"
				: post?.Post?.link.startsWith("zoom")
					? "bg-blue-100 text-blue-700 ring-1 ring-blue-200"
					: "bg-green-100 text-green-700 ring-1 ring-green-200"
		}`}
								>
									{post?.Post?.link.startsWith("t.me") ? <TG /> : ""}
									{post?.Post?.link.startsWith("zoom") ? <ZOOM /> : ""}
									–í–æ–π—Ç–∏ –Ω–∞ –≥—Ä—É–ø–ø—É
								</a>
							</main>
						</article>
					))
		}
	</section>

	<!-- <script>
		document.querySelector("#link").addEventListener("click", function (event) {
			event.preventDefault() // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ

			// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ª–∏ –æ—Ç–≤–µ—Ç –≤ localStorage
			const isVerified = localStorage.getItem("isVerified")

			if (isVerified === "true") {
				// –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç —É–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω, —Å—Ä–∞–∑—É –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
				window.location.href = this.href
			} else {
				// –ï—Å–ª–∏ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞, –∑–∞–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å
				const answer = prompt("–ê–ù–¢–ò–ë–û–¢: –°–∫–æ–ª—å–∫–æ –±—É–¥–µ—Ç 49 - 5?")

				if (answer === "44") {
					// –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –≤–µ—Ä–Ω—ã–π, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ localStorage –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
					localStorage.setItem("isVerified", "true")
					window.location.href = this.href
				} else {
					alert("–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.")
				}
			}
		})
	</script> -->
</Layout>
